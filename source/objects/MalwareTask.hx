package objects;

import states.PlayState;
import flixel.system.FlxAssets;
import backend.Rating;
import backend.StfUtils;
import flixel.FlxBasic;
import flixel.FlxG;

class MalwareTask extends FlxBasic
{
	public var time:Float = 0;

	public function new(Time:Float = 0)
	{
		super();
		time = Time;
	}

	override function update(elapsed:Float)
	{
		if (StfUtils.hitDelay(FlxG.sound.music.time, this.time) >= 2000)
			doMiss();
		super.update(elapsed);
	}

	public function hitCheck():Rating
	{
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 0, this.time)) // Yeah, good luck with this one
			return HOW;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 250, this.time))
			return PERFECT;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 500, this.time))
			return YOO;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 690, this.time)) // (¬‿¬)
			return NICE;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 750, this.time))
			return GOOD;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 1000, this.time))
			return OK;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 1250, this.time))
			return UM;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 1500, this.time))
			return BAD;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 1750, this.time))
			return NAHH;
		if (StfUtils.inHitWindow(FlxG.sound.music.time, 2000, this.time))
			return BRUH;
		return MISS;
	}

	public function doHitCheck()
	{
		if (hitCheck() == MISS)
		{
			// if (FlxG.sound.music.time >= this.time)
			// 	doMiss();
			PlayState.instance.endTask.ghostTaps++;
			return false;
		}
		PlayState.instance.endTask.hits++;
		FlxG.sound.play(FlxAssets.getSound(AssetPaths.hitsound1__ogg));
		return true;
	}

	public function doMiss()
	{
		// Do Miss
		PlayState.instance.endTask.misses++;
		FlxG.sound.play(FlxAssets.getSound(AssetPaths.misssound1__ogg));
		kill();
	}
}
